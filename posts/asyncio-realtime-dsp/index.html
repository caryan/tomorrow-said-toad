<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>asyncio real-time signal processing - Tomorrow Said Toad</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Using Python&rsquo;s asyncio for real-time signal processing" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://www.colmryan.org/posts/asyncio-realtime-dsp/">
  <meta property="og:site_name" content="Tomorrow Said Toad">
  <meta property="og:title" content="asyncio real-time signal processing">
  <meta property="og:description" content="Using Python’s asyncio for real-time signal processing">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2015-09-20T00:00:00+00:00">
    <meta property="article:modified_time" content="2015-09-20T00:00:00+00:00">
    <meta property="article:tag" content="Software">
    <meta property="article:tag" content="Python">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="asyncio real-time signal processing">
  <meta name="twitter:description" content="Using Python’s asyncio for real-time signal processing">

        <link href="https://www.colmryan.org/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.colmryan.org/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://www.colmryan.org/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css" media="(prefers-color-scheme: dark)"  /><script type="text/javascript"
		src="https://www.colmryan.org/js/MathJax.js"></script>
		
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script><link rel="stylesheet" href="https://www.colmryan.org/katex/katex.min.css ">
		<script defer src="https://www.colmryan.org/katex/katex.min.js"></script>
		<script defer src="https://www.colmryan.org/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
					renderMathInElement(document.body, {
							delimiters: [
									{left: "$$", right: "$$", display: true},
									{left: "$", right: "$", display: false}
							]
					});
			});
		</script>
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://www.colmryan.org/">Tomorrow Said Toad</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">All posts</a>
		
		<a href="/about">About</a>
		
		<a href="/tags">Tags</a>
		
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">asyncio real-time signal processing</h1>
          <div class="meta">Posted on Sep 20, 2015</div>
        </div>
        
        <section class="body">
          <p>I&rsquo;m taken with using Python&rsquo;s relatively recent asycio module for real-time DSP.
This isn&rsquo;t because it looks particularly efficient but because it looks very
similar to how we do DSP on an FPGA. Of course we won&rsquo;t actually get the massive
parallelism of a real FPGA but by setting up all our coroutines at the start and
letting things go, the data will naturally flow through the processing chain and
handle back pressure without any particular intervention or scheduling by us.
This also allows us to tap into the the data stream at any point for addition
processing, plotting or saving.</p>
<p>In FPGA land we have all our DSP (FIR filtering, demodulating, decimating etc.)
as modules that takes streams of data (AXI streams) and every clock cycle
they&rsquo;ll process data with something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-VHDL" data-lang="VHDL"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> rising_edge(clk) <span style="color:#66d9ef">and</span> data_vld <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;1&#39;</span> <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>	process_data....
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#66d9ef">if</span>;
</span></span></code></pre></div><p>All the modules are connected by FIFOs that allow the system to cross clock
domains and soak up back-pressure if the system is producing data faster than it
can be processed. Of course if the system is continually taking data faster than
processing we&rsquo;ll run into an issue but for short burst of data this works well
as the chains of FIFO&rsquo;s just absorb the pressure without any additional
thinking.</p>
<p>With Python&rsquo;s asyncio co-routines and Queues we should be able to setup
something very similar. Let&rsquo;s setup a simple class structure with
<code>DataProducer</code>&rsquo;s,  <code>DataCrucher</code>&rsquo;s, <code>DataPlotters</code>&rsquo;s, and <code>DataWriters</code>.</p>
<p>A <code>DataProducer</code> is anything that produces data that can be consumed by
anything else.  At the start this may be an ADC but in a chain of filters each
element is a <code>DataCruncher</code> that also acts as a <code>DataProducer</code> for next
element in the chain.  Let&rsquo;s make a fake ADC that takes data up to a timeout
and then finishes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DataProducer</span>(object):
</span></span><span style="display:flex;"><span>	queue
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ADC</span>(DataProducer):
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	    <span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">take_data</span>(self, loop, timeout):
</span></span><span style="display:flex;"><span>	        end_time <span style="color:#f92672">=</span> loop<span style="color:#f92672">.</span>time() <span style="color:#f92672">+</span> timeout
</span></span><span style="display:flex;"><span>	        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>	            data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand(<span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>	            timeStamp <span style="color:#f92672">=</span> str(datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>now())
</span></span><span style="display:flex;"><span>	            logging<span style="color:#f92672">.</span>info(<span style="color:#e6db74">&#34;Acquired data and putting in queue&#34;</span>)
</span></span><span style="display:flex;"><span>	            <span style="color:#66d9ef">await</span> self<span style="color:#f92672">.</span>queue<span style="color:#f92672">.</span>put(data)
</span></span><span style="display:flex;"><span>	            <span style="color:#66d9ef">if</span> (loop<span style="color:#f92672">.</span>time() <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span>) <span style="color:#f92672">&gt;=</span> end_time:
</span></span><span style="display:flex;"><span>	                shutdown(loop)
</span></span><span style="display:flex;"><span>	                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>	            <span style="color:#66d9ef">await</span> asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p>A <code>DataProducer</code> has a queue that it pushes data to.  The data will be
correctly routed by a <code>DataInterconnect</code> later. We define the <code>take_data</code>
method as an async co-routine using the new Python 3.5 syntax of <code>async def</code>.
Since the
<a href="https://docs.python.org/3/library/asyncio-queue.html#asyncio.Queue.put">Queue.put</a>
method is a coroutine we <code>await</code> on that (again using the the new syntax
instead of the old <code>yield from</code>).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>class DataCrucher(DataProducer):
</span></span><span style="display:flex;"><span>	pass
</span></span></code></pre></div><p>In Python the FIFOs will be handled by
<a href="https://docs.python.org/3/library/asyncio-queue.html">asyncio.Queue</a></p>

        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/software">software</a></li>
              
              <li><a href="/tags/python">python</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="mailto:colm@colmryan.org" rel="me" title="Email"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#mail" />
</svg></a><a class="border"></a><a class="soc" href="https://github.com/caryan/" rel="me" title="GitHub"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github" />
</svg></a><a class="border"></a><a class="soc" href="https://gitlab.com/caryan" rel="me" title="GitLab"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#gitlab" />
</svg></a><a class="border"></a></div>
  <div class="footer-info">
    2025  © Colm Ryan |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>



</div>
    </body>
</html>
