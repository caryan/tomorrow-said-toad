<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Where to sample a Ramsey experiment - Tomorrow Said Toad</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="The tradeoff between sensitivity and shot noise" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://www.colmryan.org/posts/where_to_sample_a_ramsey/">
  <meta property="og:site_name" content="Tomorrow Said Toad">
  <meta property="og:title" content="Where to sample a Ramsey experiment">
  <meta property="og:description" content="The tradeoff between sensitivity and shot noise">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-06-30T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-06-30T00:00:00+00:00">
    <meta property="article:tag" content="Information Theory">
    <meta property="article:tag" content="Software">
    <meta property="article:tag" content="Julia">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Where to sample a Ramsey experiment">
  <meta name="twitter:description" content="The tradeoff between sensitivity and shot noise">

        <link href="https://www.colmryan.org/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.colmryan.org/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://www.colmryan.org/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css" media="(prefers-color-scheme: dark)"  /><script type="text/javascript"
		src="https://www.colmryan.org/js/MathJax.js"></script>
		
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script><link rel="stylesheet" href="https://www.colmryan.org/katex/katex.min.css ">
		<script defer src="https://www.colmryan.org/katex/katex.min.js"></script>
		<script defer src="https://www.colmryan.org/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
					renderMathInElement(document.body, {
							delimiters: [
									{left: "$$", right: "$$", display: true},
									{left: "$", right: "$", display: false}
							]
					});
			});
		</script>
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://www.colmryan.org/">Tomorrow Said Toad</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">All posts</a>
		
		<a href="/about">About</a>
		
		<a href="/tags">Tags</a>
		
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">Where to sample a Ramsey experiment</h1>
          <div class="meta">Posted on Jun 30, 2020</div>
        </div>
        
        <section class="body">
          <p>Let&rsquo;s take a look at the experimental design problem of choosing the sampling points when  estimating frequency with a Ramsey experiment. The intuitive result is that we should measure at the point of maximum slope to maximize our sensitivity. However, when measuring a qubit we will run into a tradeoff between sensitivity and projection noise. We will work through the surprising result that these two effects perfectly balance such that all sampling points give the same information.</p>
<h1 id="ramsey-sequence">Ramsey Sequence</h1>
<p>A time-domain Ramsey experiment is typically used to measure the frequency (and \(T_2\)) of a qubit. We start with the qubit in the ground state, apply a \(X_{90}\) pulse to create a superposition of |0⟩ and |1⟩ with a defined phase, let the superposition evolve for some time \(t\), apply a second \(X_{90}\) to convert the phase of the superposition in a population that can be read out. If the qubit is detuned with respect to the frame of the drive by a frequency \(f\) then the probability of measuring a |1⟩ goes as \(\cos(2\pi ft/2)^2\).</p>
<p>If we convert \(f\) and \(t\) to some accumulated phase \(\theta\) then the idealized Ramsey signal is a simple sinusoid and measuring the sinusoid gives us information about the qubit frequency. Intuitively, to maximize the information gained from the experiment we want to sample at the maximum slope at \(\theta = \frac{\pi}{2}\) or \(\theta = \frac{3\pi}{2}\) where small changes in phase lead to large changes in the measurement outcome and vice-versa we do not want to measure at the extrema at 0 or \(\pi\) where small changes in frequency will change the probability of |1⟩ very little.  And so if we have a good prior for the frequency we should choose our sampling time to give us the maximum sensitivity.</p>
<figure><img src="/posts/where_to_sample_a_ramsey/ramsey_fringe.svg" width="100%">
</figure>

<p>We can visualize this by adding Gaussian noise on top of the Ramsey fringe sinusoid and looking at the likelihood distribution for \(\theta\) given we measured the probability of |1⟩ to be \(x\). Near the extrema at 0 or 1 the likelihood is broad and so our uncertainty about \(\theta\) is still large whereas at the points of maximum slope the likelihood is sharply peaked and so we have more more information about \(\theta\).</p>
<figure><img src="/posts/where_to_sample_a_ramsey/likelihood.svg" width="100%">
</figure>

<p>However, if we are measuring a qubit then there is an additional wrinkle: the points of maximum slope come at the 50% probability of |1⟩ when the qubit is left in an equal superposition state. Measuring a qubit gives binary outcomes like coin flips and at this 50% point we have maximum variance in the outcome and so we would expect less information. The information coming from the slope of the Ramsey curve is fighting against the variance from the projection noise. We will show that surprisingly these two effects perfectly cancel out.</p>
<h1 id="fisher-information">Fisher Information</h1>
<p>We will start with some random variable \(X\) we are measuring that depends on an unknown parameter \(\theta\) and we are trying to use the measurements of \(X\) to infer \(\theta\). The Fisher information makes concrete the intuition that regions of steep slope or sharp peaks in the output probability versus \(\theta\) as will have much more information than flat regions. If the probability density/mass function for getting some output \(x\) given \(\theta\) is \(f(x|\theta)\). then the Fisher information is the variance of the partial derivative of \(f(x|\theta)\):</p>
$$
\mathcal{I(\theta)} = E\left[ \left(\frac{\partial}{\partial\theta} \log f(x|\theta) \right)^2 \right] = \int dx \left( \frac{\partial}{\partial\theta} \log f(x|\theta)\right)^2 f(x|\theta)
$$<p>If we can take the second derivative then:</p>
$$
\frac{\partial ^2}{\partial\theta ^2} \log f(x|\theta)
= \frac{\partial}{\partial\theta} \left( \frac{ \frac{\partial}{\partial\theta } f(x|\theta) } {f(x|\theta)} \right)
= \frac{\frac{\partial ^2}{\partial\theta ^2} f(x|\theta)}{f(x|\theta)} - \frac{(\frac{\partial}{\partial\theta } f(x|\theta))^2}{f(x|\theta) ^2}
$$<p>If we then take an expectation value over \(x\) then the first term vanishes:</p>
$$
E\left[ \frac{\frac{\partial ^2}{\partial\theta ^2} f(x|\theta)}{f(x|\theta)} \right]
= \int dx \frac{\frac{\partial ^2}{\partial\theta ^2} f(x|\theta)}{f(x|\theta)} f(x|\theta)
= \frac{\partial ^2}{\partial\theta ^2} \int dx f(x|\theta)
= \frac{\partial ^2}{\partial\theta ^2} 1
= 0
$$<p>and the second term equals the integrand in \(\mathcal{I}(\theta)\) as defined above so</p>
$$
\mathcal{I(\theta)} = -E\left[ \frac{\partial ^2}{\partial\theta ^2} \log f(x|\theta) \right]
$$<p>This nicely quantifies the intuition above that we are looking for sharply peaked regions of the likelihood.</p>
<h2 id="fisher-information-for-a-bernoulli-trial">Fisher Information for a Bernoulli trial</h2>
<p>Take \(f(x|\theta)\) to for a Bernouilli trial i.e. the outcomes are either 0 or 1 and the underlying parameter we are trying to estimate, \(\theta\), is the probability of getting a 1.</p>
$$
f(x|\theta) = θ^x (1-θ)^{1-x}
$$<p>Then</p>
$$
\begin{aligned}
\frac{\partial^2}{\partial\theta^2} \log f(x|\theta)
&= \frac{\partial^2}{\partial\theta^2} \left( x\log\theta + (1-x)\log(1-\theta) \right) \\
&= -\frac{x}{\theta^2} - \frac{1-x}{(1-\theta)^2}
\end{aligned}
$$<p>If we take the expectation value over \(x\) then this becomes a discrete sum or we can just push the expectation value into \(E[x] = \theta\) so</p>
$$
\begin{aligned}
\mathcal{I}(\theta) &= -E\left[-\frac{x}{\theta^2} - \frac{1-x}{(1-\theta)^2}\right] \\
&= \frac{E[x]}{\theta^2} - \frac{1-E[x]}{(1-\theta)^2} \\
&= \frac{1}{\theta} + \frac{1}{1-\theta} \\
&= \frac{1}{\theta(1-\theta)}
\end{aligned}
$$<p>Hence, we expect the Fisher information to go to infinity as θ goes to either 0 or 1 and reaches a minimum of 4 at the 50:50 probability point.</p>
<figure><img src="/posts/where_to_sample_a_ramsey/fisher_information_bernoulli.svg" width="100%">
</figure>

<h2 id="fisher-information-for-a-sinusoid-with-additive-gaussian-noise">Fisher information for a sinusoid with additive Gaussian noise</h2>
<p>If we go back to a sinusoid with noise independent of \(\theta\) then we can confirm the original intuition that the most information comes at the slope. If we assume independent Gaussian noise on top of a sinusoid and take \(N(\mu, \sigma^2)\) to be the normal distribution with mean \(\mu\) and variance \(\sigma^2\) then \(f(x|θ) = N(\cos\theta, σ^2)\) and</p>
$$
\begin{aligned}
\frac{\partial^2}{\partial\theta^2} \log f(x|\theta)
&= \frac{\partial^2}{\partial\theta^2} \log \left( \frac{1}{\sigma\sqrt{2\pi}} \exp\left(-\frac{1}{2} \left(\frac{x-\cos\theta}{\sigma}\right)^2 \right) \right) \\
&= \frac{\partial^2}{\partial\theta^2}\left(\log(\frac{1}{2σ\sqrt{2\pi}}) -\frac{1}{2\sigma^2} \left(x-\cos\theta\right)^2 \right) \\
&= -\frac{1}{\sigma^2}\frac{\partial}{\partial\theta}\left(\left(x-\cos\theta\right)\sin\theta\right) \\
&= -\frac{1}{\sigma^2}\left(x\cos\theta - \cos(2\theta) \right)
\end{aligned}
$$<p>Then taking the expectation value to get the Fisher information (and using the both that the expectation value of \(x\) is the mean value \(\cos\theta\) and the double angle identity)</p>
$$
\begin{aligned}
\mathcal{I}(\theta)
&= -E\left[-\frac{1}{\sigma^2}\left(x\cos\theta - \cos(2\theta) \right)\right] \\
&= \frac{1}{\sigma^2}\left(E[x]\cos\theta - \cos(2\theta)\right) \\
&= \frac{1}{\sigma^2}\left(\cos^2\theta - (\cos^2\theta - \sin^2\theta) \right) \\
&= \frac{1}{\sigma^2}\sin^2\theta
\end{aligned}
$$<figure><img src="/posts/where_to_sample_a_ramsey/fisher_information_sinusoid_gaussian.svg" width="100%">
</figure>

<h1 id="fisher-information-in-a-ramsey-experiment">Fisher Information in a Ramsey Experiment</h1>
<p>Finally we look at the Fisher information for a Bernouilli trial where the success probability (probability of measuring a 1) goes as the Ramsey fringe probability \(\cos^2\left(\frac{\theta}{2}\right)\) where \(\theta\) is the accumulated phase during the Ramsey free evolution. Therefore,</p>
$$
\log f(x|\theta) = x \log \left(\cos^2\left(\frac{\theta}{2}\right)\right) + (1-x)\log\left(1-\cos^2\left(\frac{\theta}{2}\right)\right)
$$<p>and</p>
$$
\begin{aligned}
\frac{\partial^2}{\partial\theta^2} \log f(x|\theta)
&= \frac{\partial}{\partial\theta}\left[2x\frac{-\frac{1}{2}\sin\left(\frac{\theta}{2}\right)}{\cos\left(\frac{\theta}{2}\right)} + (1-x)\frac{\cos\left(\frac{\theta}{2}\right)\sin\left(\frac{\theta}{2}\right)}{1-\cos^2\left(\frac{\theta}{2}\right)}\right] \\
&= \frac{\partial}{\partial\theta}\left[-x\tan\left(\frac{\theta}{2}\right) + (1-x)\cot\left(\frac{\theta}{2}\right) \right] \\
&= \frac{-x}{2\cos^2\left(\frac{\theta}{2}\right)} + \frac{-(1-x)}{2\sin^2\left(\frac{\theta}{2}\right)}
\end{aligned}
$$<p>Finally we can evaluate the Fisher information by taking the expectation value over \(x\) and using the fact that \(E[x] = \cos^2\left(\frac{\theta}{2}\right)\)</p>
$$
\begin{aligned}
\mathcal{I}(\theta)
&= -E\left[ \frac{-x}{2\cos^2\left(\frac{\theta}{2}\right)} + \frac{-(1-x)}{2\sin^2\left(\frac{\theta}{2}\right)} \right] \\
&= 1
\end{aligned}
$$<p>And so we arrive at the surprising result that the contributions to the Fisher information from the sinusoid and Bernoulli terms perfectly cancel leaving a constant Fisher information. Of course this is only for the case of perfect projection noise. In some experiments with low single shot readout fidelity there will be a mixture of Gaussian and projection noise and there will be an advantage to optimizing the sampling.</p>
<figure><img src="/posts/where_to_sample_a_ramsey/fisher_information_sinusoid_projection.svg" width="100%">
</figure>

<h1 id="julia-notebook">Julia Notebook</h1>
<p>Calculating the Fisher information requires taking derivatives of the log-likelihood and so it was a fun excuse to use the <a href="https://github.com/FluxML/Zygote.jl">Zygote.jl</a> automatic differentiation package in Julia. I was impressed that with <a href="https://github.com/JuliaStats/Distributions.jl">Distributions.jl</a> augmented with <a href="https://github.com/TuringLang/DistributionsAD.jl">DistributionsAD.jl</a> I could easily take derivatives of the <code>logpdf</code> of a distribution. The notebook has a function for numerically calculating the Fisher information and generates the plots above.</p>
<p><a href="https://nbviewer.jupyter.org/gist/caryan/75f6b0d48472de2a610b0a2d50510a25">nbviewer with plots</a></p>
<script src="https://gist.github.com/caryan/75f6b0d48472de2a610b0a2d50510a25.js"></script>


        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/information-theory">information theory</a></li>
              
              <li><a href="/tags/software">software</a></li>
              
              <li><a href="/tags/julia">julia</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="mailto:colm@colmryan.org" rel="me" title="Email"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#mail" />
</svg></a><a class="border"></a><a class="soc" href="https://github.com/caryan/" rel="me" title="GitHub"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github" />
</svg></a><a class="border"></a><a class="soc" href="https://gitlab.com/caryan" rel="me" title="GitLab"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#gitlab" />
</svg></a><a class="border"></a></div>
  <div class="footer-info">
    2025  © Colm Ryan |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>



</div>
    </body>
</html>
