<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Tomorrow Said Toad</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="https://www.colmryan.org/css/main.min.2545a1910010e26a9905276045afab868f812580a1e7482423da6c0c8c214d18.css"/>

    
    
    

    
    
 
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-158537342-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="/">Tomorrow Said Toad</a>
    </div>  
</header>
  <div class="nav-menu">
  
  <a class="color-link nav-link" href="https://www.colmryan.org/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        
    <a class="social-icon" href="mailto:colm@colmryan.org" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    
    <a class="social-icon" href="https://www.linkedin.com/in/colm-ryan-660687113" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/caryan/" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    
    <a class="social-icon" href="https://gitlab.com/caryan" target="_blank" rel="noopener" title="GitLab">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M25.8928355,15.330615 L24.6377766,11.4743798 C24.6311235,11.4388709 24.6209558,11.4041117 24.6074237,11.370615 L22.0895413,3.62002681 C21.9519499,3.20985323 21.5664025,2.9345029 21.1337766,2.93743857 C20.7020628,2.93482083 20.3190624,3.21391308 20.189306,3.62567387 L17.789306,11.0113209 L10.2144825,11.0113209 L7.8109531,3.62567387 C7.68166096,3.2154114 7.3008703,2.9366795 6.8707178,2.93743857 L6.86507074,2.93743857 C6.43207772,2.9375139 6.04793469,3.21523509 5.91212957,3.62637975 L3.39212957,11.3861445 C3.39212957,11.3932033 3.38648251,11.3988503 3.38436486,11.4059092 L2.1067178,15.3313209 C1.91410826,15.9219503 2.1242249,16.569406 2.6269531,16.9343798 L13.6655413,24.9553209 C13.8649064,25.0996309 14.1347733,25.098203 14.3326002,24.9517915 L25.373306,16.9343798 C25.8762704,16.5692556 26.0861711,15.9213012 25.8928355,15.330615 M9.39283545,12.144968 L12.4697766,21.6150856 L5.08342369,12.144968 M15.5340119,21.6172033 L18.4846002,12.5381445 L18.611659,12.144968 L22.9246002,12.144968 L16.2420119,20.7059092 M21.143659,4.35273269 L23.3057766,11.0113209 L18.9780119,11.0113209 M17.4229531,12.1407327 L15.2791884,18.7379092 L14.0001296,22.6668503 L10.5822472,12.1407327 M6.86012957,4.35273269 L9.02648251,11.0113209 L4.70154133,11.0113209 M3.29118839,16.020968 C3.18436061,15.9432767 3.13987047,15.8055284 3.18107074,15.6800268 L4.12977663,12.7647327 L11.087659,21.684968 M24.7097766,16.020968 L16.9126002,21.6828503 L16.9387178,21.648968 L23.8704825,12.7647327 L24.8191884,15.678615 C24.8608813,15.8041731 24.8166519,15.9422827 24.7097766,16.0202621"></path>
        </svg>
    </a>
    

    
</div>




	<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
	<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>

	<script src="https://www.colmryan.org/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        
<h1 class="post-title">Asyncio Socket Pool</h1>
    <time>August 12, 2019</time>
    <div>
        <p>
        <p>In a typical client-server over a socket setup the server may take some time to process any given
request and so to allow thee client to fire off multiple requests in parallel to speed things up
there are two common paths:</p>
<ol>
<li>We can make the server interface asynchronous so that it is able to take a whole series of
requests and respond to them out of order.</li>
<li>The server can support multiple socket connections, but each one is
blocking and so we can parallelize communications across the multiple sockets.</li>
</ol>
<p>The first is more elegant but requires additional work to allow the server to asynchronously
dispatch requests and keep responding to new ones and for the client to handle the out of order
replies. We took that path with the <a href="https://github.com/rigetti/rpcq/tree/master/rpcq">rpcq
client-server</a> For simpler cases, multiple sockets
might be sufficient.</p>
<p>Here is a simple implementation of a client socket pool wrapped an an <a href="https://docs.python.org/3/library/contextlib.html#contextlib.asynccontextmanager">asynccontextmanager
decorator</a> so that
we can nicely <code>async with ...</code> <code>await</code> on the next available socket. To bound the number of sockets
we use an <a href="https://docs.python.org/3/library/asyncio-sync.html#asyncio.Semaphore">asyncio
Semaphore</a>. The semaphore is
an integer that is intialized to the maximum number of sockets. Every time a socket is checked out
from the pool we <code>await</code> on the semphaore, the integer is decremented by one and then finally the
semaphore blocks when the integer would go negative. When we are done with the socket we return it
to the pool and increment the semaphore integer again. All this integer decrement/increment logic is
wrapped with by the Python <code>asyncio</code> module with another <code>asynccontextmanager</code> so all the
bookkeeping so the interface is a simple <code>async with self.semaphore:</code>. We&rsquo;ll return the high-level
<code>asyncio StreamReader/StreamWriter</code> to provide access to the socket.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> asyncio
<span style="color:#f92672">from</span> contextlib <span style="color:#f92672">import</span> asynccontextmanager
<span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Optional, Tuple

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SocketPool</span>():
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">    A pool of socket connections for a client to access some server.</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">    </span><span style="color:#e6db74">&#34;&#34;&#34;</span>
    address: str
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74"> Hostname for the server </span><span style="color:#e6db74">&#34;&#34;&#34;</span>

    port: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">1234</span>
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74"> Port that the instrument is listening for connections on. </span><span style="color:#e6db74">&#34;&#34;&#34;</span>

    max_num_sockets: int <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74"> Maximum number of open sockets to the server </span><span style="color:#e6db74">&#34;&#34;&#34;</span>

    semaphore: asyncio<span style="color:#f92672">.</span>Semaphore
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74"> Use a semaphore to bound the number of open connection to `max_num_sockets` </span><span style="color:#e6db74">&#34;&#34;&#34;</span>

    pool: list
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74"> List of socket StreamReader, StreamWriter pairs </span><span style="color:#e6db74">&#34;&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> __init__(self, address: str, max_num_sockets: Optional[int] <span style="color:#f92672">=</span> None, port: Optional[int] <span style="color:#f92672">=</span> None):
        self<span style="color:#f92672">.</span>address <span style="color:#f92672">=</span> address

        <span style="color:#75715e"># if we&#39;re passed some `max_num_sockets` or `port` then override the defaults</span>
        <span style="color:#66d9ef">if</span> max_num_sockets <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
            self<span style="color:#f92672">.</span>max_num_sockets <span style="color:#f92672">=</span> max_num_sockets

        <span style="color:#66d9ef">if</span> port <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
            self<span style="color:#f92672">.</span>port <span style="color:#f92672">=</span> port

        self<span style="color:#f92672">.</span>semaphore <span style="color:#f92672">=</span> asyncio<span style="color:#f92672">.</span>Semaphore(self<span style="color:#f92672">.</span>max_num_sockets)

        <span style="color:#75715e"># a list to hold onto the (asyncio.StreamReader, asyncio.StreamWriter) tuples for each socket</span>
        self<span style="color:#f92672">.</span>pool <span style="color:#f92672">=</span> []

    <span style="color:#a6e22e">@asynccontextmanager</span>
    async <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_socket</span>(self) <span style="color:#f92672">-</span><span style="color:#f92672">&gt;</span> Tuple[asyncio<span style="color:#f92672">.</span>StreamReader, asyncio<span style="color:#f92672">.</span>StreamWriter]:
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">        Get the next available socket reader/writer from the pool</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">        </span><span style="color:#e6db74">&#34;&#34;&#34;</span>
        async <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>semaphore:
            <span style="color:#66d9ef">try</span>:
                <span style="color:#75715e"># take the last socket in the pool</span>
                reader, writer <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>pop()
            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">IndexError</span>:
                <span style="color:#75715e"># empty list so create a new socket</span>
                _log<span style="color:#f92672">.</span>info(f<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Adding socket connection to server at {self.address}</span><span style="color:#e6db74">&#34;</span>)
                reader, writer <span style="color:#f92672">=</span> await asyncio<span style="color:#f92672">.</span>open_connection(self<span style="color:#f92672">.</span>address, self<span style="color:#f92672">.</span>port)
            <span style="color:#66d9ef">try</span>:
                <span style="color:#75715e"># hand the reader/writer pair back to the caller</span>
                <span style="color:#66d9ef">yield</span> reader, writer
            <span style="color:#66d9ef">finally</span>:
                <span style="color:#75715e"># put the socket back in the pool</span>
                self<span style="color:#f92672">.</span>pool<span style="color:#f92672">.</span>append((reader, writer))
</code></pre></div><p>We can then test this out with a simple echo server that listens for connections and then takes some
time to respond.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#f92672">import</span> asyncio

async <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">handle_echo</span>(reader, writer):
    data <span style="color:#f92672">=</span> await reader<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">100</span>)
    message <span style="color:#f92672">=</span> data<span style="color:#f92672">.</span>decode()
    addr <span style="color:#f92672">=</span> writer<span style="color:#f92672">.</span>get_extra_info(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">peername</span><span style="color:#e6db74">&#39;</span>)

    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Received {message!r} from {addr!r}</span><span style="color:#e6db74">&#34;</span>)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Taking a second to process something....</span><span style="color:#e6db74">&#34;</span>)
    await asyncio<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1.0</span>)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Sending back response.</span><span style="color:#e6db74">&#34;</span>)
    writer<span style="color:#f92672">.</span>write(data)
    await writer<span style="color:#f92672">.</span>drain()

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Close the connection</span><span style="color:#e6db74">&#34;</span>)
    writer<span style="color:#f92672">.</span>close()

async <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    server <span style="color:#f92672">=</span> await asyncio<span style="color:#f92672">.</span>start_server(handle_echo, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">localhost</span><span style="color:#e6db74">&#34;</span>, <span style="color:#ae81ff">1234</span>)

    addr <span style="color:#f92672">=</span> server<span style="color:#f92672">.</span>sockets[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>getsockname()
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Serving on {addr}</span><span style="color:#e6db74">&#34;</span>)

    async <span style="color:#66d9ef">with</span> server:
        await server<span style="color:#f92672">.</span>serve_forever()

asyncio<span style="color:#f92672">.</span>run(main())
</code></pre></div><p>And then a simple client side function to use it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> asyncio
<span style="color:#f92672">from</span> wherever.socket_pool <span style="color:#f92672">import</span> SocketPool

async <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_message</span>(pool, msg):
    <span style="color:#75715e"># check out a socket</span>
    async <span style="color:#66d9ef">with</span> pool<span style="color:#f92672">.</span>get_socket() <span style="color:#66d9ef">as</span> (reader, writer):
        <span style="color:#75715e"># send the message</span>
        writer<span style="color:#f92672">.</span>write(msg<span style="color:#f92672">.</span>encode())
        await writer<span style="color:#f92672">.</span>drain()
        <span style="color:#75715e"># wait for the echo response</span>
        resp <span style="color:#f92672">=</span> await reader<span style="color:#f92672">.</span>read(<span style="color:#ae81ff">100</span>)
        <span style="color:#66d9ef">return</span> resp<span style="color:#f92672">.</span>decode()

pool <span style="color:#f92672">=</span> SocketPool(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">localhost</span><span style="color:#e6db74">&#34;</span> max_num_sockets<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">(base) cryan<span style="color:#a6e22e">@cryan</span><span style="color:#f92672">-</span>Precision<span style="color:#f92672">-</span><span style="color:#ae81ff">5510</span>:<span style="color:#f92672">~</span><span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#960050;background-color:#1e0010">$</span> ipython
Python <span style="color:#ae81ff">3.7</span><span style="color:#f92672">.</span><span style="color:#ae81ff">4</span> (default, Aug <span style="color:#ae81ff">13</span> <span style="color:#ae81ff">2019</span>, <span style="color:#ae81ff">20</span>:<span style="color:#ae81ff">35</span>:<span style="color:#ae81ff">49</span>)
Type <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">copyright</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">credits</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">license</span><span style="color:#e6db74">&#39;</span> <span style="color:#66d9ef">for</span> more information
IPython <span style="color:#ae81ff">7.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">-</span><span style="color:#f92672">-</span> An enhanced Interactive Python<span style="color:#f92672">.</span> Type <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">?</span><span style="color:#e6db74">&#39;</span> <span style="color:#66d9ef">for</span> help<span style="color:#f92672">.</span>

In [<span style="color:#ae81ff">1</span>]: <span style="color:#f92672">%</span>paste <span style="color:#75715e"># import the client code</span>
<span style="color:#75715e"># send a single message and a single socket is created</span>
In [<span style="color:#ae81ff">2</span>]: await send_message(pool, <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Hello!</span><span style="color:#e6db74">&#34;</span>)
Adding socket connection to server at localhost
Out[<span style="color:#ae81ff">2</span>]: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Hello!</span><span style="color:#e6db74">&#39;</span>

<span style="color:#75715e"># we can inspect the pool and see indeed there is one socket there</span>
In [<span style="color:#ae81ff">3</span>]: pool<span style="color:#f92672">.</span>pool
Out[<span style="color:#ae81ff">3</span>]:
[(<span style="color:#f92672">&lt;</span>StreamReader transport<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>_SelectorSocketTransport fd<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span> read<span style="color:#f92672">=</span>polling write<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>idle, bufsize<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>StreamWriter transport<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>_SelectorSocketTransport fd<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span> read<span style="color:#f92672">=</span>polling write<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>idle, bufsize<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">&gt;&gt;</span> reader<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>StreamReader transport<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>_SelectorSocketTransport fd<span style="color:#f92672">=</span><span style="color:#ae81ff">16</span> read<span style="color:#f92672">=</span>polling write<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>idle, bufsize<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;&gt;</span>)]

In [<span style="color:#ae81ff">4</span>]: len(pool<span style="color:#f92672">.</span>pool)
Out[<span style="color:#ae81ff">4</span>]: <span style="color:#ae81ff">1</span>

<span style="color:#75715e"># now send a slew of requests at once and it still takes only a second to respond</span>
In [<span style="color:#ae81ff">5</span>]: await asyncio<span style="color:#f92672">.</span>wait([send_message(pool, str(ct)) <span style="color:#66d9ef">for</span> ct <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">5</span>)])
Adding socket connection to server at localhost
Adding socket connection to server at localhost
Adding socket connection to server at localhost
Adding socket connection to server at localhost
Out[<span style="color:#ae81ff">5</span>]:
({<span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">0</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">1</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">2</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">3</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">4</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>},
 set())

<span style="color:#75715e"># and we have 5 sockets in the pool</span>
In [<span style="color:#ae81ff">6</span>]: len(pool<span style="color:#f92672">.</span>pool)
Out[<span style="color:#ae81ff">6</span>]: <span style="color:#ae81ff">5</span>

<span style="color:#75715e"># finally send even more requests and it takes about 4 seconds to respond as only 5 requests are outstanding at any time</span>
In [<span style="color:#ae81ff">7</span>]: await asyncio<span style="color:#f92672">.</span>wait([send_message(pool, str(ct)) <span style="color:#66d9ef">for</span> ct <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">20</span>)])
Out[<span style="color:#ae81ff">7</span>]:
({<span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">0</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">1</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">10</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">11</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">12</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">13</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">14</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">15</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">16</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">17</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">18</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">19</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">2</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">3</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">4</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">5</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">6</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">7</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">8</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>,
  <span style="color:#f92672">&lt;</span>Task finished coro<span style="color:#f92672">=</span><span style="color:#f92672">&lt;</span>send_message() done, defined at <span style="color:#f92672">/</span>home<span style="color:#f92672">/</span>cryan<span style="color:#f92672">/</span>repos<span style="color:#f92672">/</span>tomorrow<span style="color:#f92672">-</span>said<span style="color:#f92672">-</span>toad<span style="color:#f92672">/</span>content<span style="color:#f92672">/</span>client<span style="color:#f92672">.</span>py:<span style="color:#ae81ff">61</span><span style="color:#f92672">&gt;</span> result<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">9</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">&gt;</span>},
 set())

In [<span style="color:#ae81ff">8</span>]: len(pool<span style="color:#f92672">.</span>pool)
Out[<span style="color:#ae81ff">8</span>]: <span style="color:#ae81ff">5</span>
</code></pre></div>
        </p>
    </div>
    

    <div class="page-footer">
        <hr class="footer-divider">
        
        
            <a class="tag" href="/tags/software">#software</a>
        
            <a class="tag" href="/tags/python">#python</a>
        
      
    </div>


        

<link rel="stylesheet" type="text/css" href="/css/katex.min.css">
<script type="text/javascript" src="/js/katex.min.js"></script>
<script type="text/javascript" src="/js/auto-render.min.js"onload="renderMathInElement(document.body);"></script>

        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        
    <a class="social-icon" href="mailto:colm@colmryan.org" target="_blank" rel="noopener" title="Email">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M25.2794292,5.59128519 L14,16.8707144 L2.72057081,5.59128519 C3.06733103,5.30237414 3.51336915,5.12857603 4,5.12857603 L24,5.12857603 C24.4866308,5.12857603 24.932669,5.30237414 25.2794292,5.59128519 Z M25.9956978,6.99633695 C25.998551,7.04004843 26,7.08414302 26,7.12857603 L26,20.871424 C26,21.0798433 25.9681197,21.2808166 25.9089697,21.4697335 L18.7156355,14.2763993 L25.9956978,6.99633695 Z M24.9498374,22.6319215 C24.6672737,22.7846939 24.3437653,22.871424 24,22.871424 L4,22.871424 C3.5268522,22.871424 3.09207889,22.7071233 2.74962118,22.432463 L10.0950247,15.0870594 L13.9848068,18.9768415 L14.1878486,18.7737996 L14.2030419,18.7889929 L17.6549753,15.3370594 L24.9498374,22.6319215 Z M2.00810114,21.0526627 C2.00273908,20.9929669 2,20.9325153 2,20.871424 L2,7.12857603 C2,7.08414302 2.00144896,7.04004843 2.00430222,6.99633695 L9.03436454,14.0263993 L2.00810114,21.0526627 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    

    

    
    <a class="social-icon" href="https://www.linkedin.com/in/colm-ryan-660687113" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/caryan/" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    
    <a class="social-icon" href="https://gitlab.com/caryan" target="_blank" rel="noopener" title="GitLab">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M25.8928355,15.330615 L24.6377766,11.4743798 C24.6311235,11.4388709 24.6209558,11.4041117 24.6074237,11.370615 L22.0895413,3.62002681 C21.9519499,3.20985323 21.5664025,2.9345029 21.1337766,2.93743857 C20.7020628,2.93482083 20.3190624,3.21391308 20.189306,3.62567387 L17.789306,11.0113209 L10.2144825,11.0113209 L7.8109531,3.62567387 C7.68166096,3.2154114 7.3008703,2.9366795 6.8707178,2.93743857 L6.86507074,2.93743857 C6.43207772,2.9375139 6.04793469,3.21523509 5.91212957,3.62637975 L3.39212957,11.3861445 C3.39212957,11.3932033 3.38648251,11.3988503 3.38436486,11.4059092 L2.1067178,15.3313209 C1.91410826,15.9219503 2.1242249,16.569406 2.6269531,16.9343798 L13.6655413,24.9553209 C13.8649064,25.0996309 14.1347733,25.098203 14.3326002,24.9517915 L25.373306,16.9343798 C25.8762704,16.5692556 26.0861711,15.9213012 25.8928355,15.330615 M9.39283545,12.144968 L12.4697766,21.6150856 L5.08342369,12.144968 M15.5340119,21.6172033 L18.4846002,12.5381445 L18.611659,12.144968 L22.9246002,12.144968 L16.2420119,20.7059092 M21.143659,4.35273269 L23.3057766,11.0113209 L18.9780119,11.0113209 M17.4229531,12.1407327 L15.2791884,18.7379092 L14.0001296,22.6668503 L10.5822472,12.1407327 M6.86012957,4.35273269 L9.02648251,11.0113209 L4.70154133,11.0113209 M3.29118839,16.020968 C3.18436061,15.9432767 3.13987047,15.8055284 3.18107074,15.6800268 L4.12977663,12.7647327 L11.087659,21.684968 M24.7097766,16.020968 L16.9126002,21.6828503 L16.9387178,21.648968 L23.8704825,12.7647327 L24.8191884,15.678615 C24.8608813,15.8041731 24.8166519,15.9422827 24.7097766,16.0202621"></path>
        </svg>
    </a>
    

    
</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="https://www.colmryan.org/js/main.min.fa5c2b23e07b5d9bfad267a52b4b24fdb053e6fb7524993383594926a3ac270c.js" integrity="sha256-+lwrI+B7XZv60melK0sk/bBT5vt1JJkzg1lJJqOsJww="></script>
</footer>
    </body>
</html>