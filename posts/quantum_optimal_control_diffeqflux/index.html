<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Quantum Optimal Control with SciML - Tomorrow Said Toad</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Using SciML and Julia for numerical optimized pulse shapes." />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://www.colmryan.org/posts/quantum_optimal_control_diffeqflux/">
  <meta property="og:site_name" content="Tomorrow Said Toad">
  <meta property="og:title" content="Quantum Optimal Control with SciML">
  <meta property="og:description" content="Using SciML and Julia for numerical optimized pulse shapes.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-06-09T00:00:00+00:00">
    <meta property="article:modified_time" content="2020-06-09T00:00:00+00:00">
    <meta property="article:tag" content="Software">
    <meta property="article:tag" content="Julia">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Quantum Optimal Control with SciML">
  <meta name="twitter:description" content="Using SciML and Julia for numerical optimized pulse shapes.">

        <link href="https://www.colmryan.org/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://www.colmryan.org/css/main.6a0f23ea50fd34b46fee262a5a68e17d458c51a2bc99ba1ba018065de6b180c3.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://www.colmryan.org/css/dark.50b57e12d401420df23965fed157368aba37b76df0ecefd0b1ecd4da664f01a0.css" media="(prefers-color-scheme: dark)"  /><script type="text/javascript"
		src="https://www.colmryan.org/js/MathJax.js"></script>
		
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script><link rel="stylesheet" href="https://www.colmryan.org/katex/katex.min.css ">
		<script defer src="https://www.colmryan.org/katex/katex.min.js"></script>
		<script defer src="https://www.colmryan.org/katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
					renderMathInElement(document.body, {
							delimiters: [
									{left: "$$", right: "$$", display: true},
									{left: "$", right: "$", display: false}
							]
					});
			});
		</script>
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://www.colmryan.org/">Tomorrow Said Toad</a>
	</div>
	<nav>
		
		<a href="/">Home</a>
		
		<a href="/posts">All posts</a>
		
		<a href="/about">About</a>
		
		<a href="/tags">Tags</a>
		
		
	</nav>
</header>

<main>
  <article>
    <div class="post-container">
      
      <div class="post-content">
        <div class="title">
          <h1 class="title">Quantum Optimal Control with SciML</h1>
          <div class="meta">Posted on Jun 9, 2020</div>
        </div>
        
        <section class="body">
          <p>Numerical quantum optimal control is simply optimizing pulse shapes used to drive the control lines on some controllable quantum system to drive that system through some desired state-to-state or unitary transformation. As with any numerical optimization gradient information makes the search much more efficient and not surprisingly two of the more successful approaches have used ways to calculate gradient information along with the evolution.</p>
<p>The Gradient Ascent Pulse Engineering (GRAPE) <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> approach assumes piece-wise constant pulse amplitudes very similar to an ideal arbitrary waveform generator and then by saving the forwards and backward evolution up to each timestep gradients for the amplitude of the control at each time step are easy to calculate. The original paper used an approximate gradient for the timestep propagator which limited it to small timesteps and/or small Hamiltonians but of course earlier work in NMR had already shown that exact derivatives are available <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> from diagonalizing the Hamiltonian which may have already been done to calculate the matrix exponential for the propagator.</p>
<p>The Gradient Optimization of Analytic conTrols (GOAT) <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> algorithm parametrizes the pulse shape as the coefficients of a series of basis functions. This is convenient because implementation constraints such as &ldquo;the pulse should start and finish at zero amplitude&rdquo; and bandwidth constraints are easy to enforce in the choice of basis functions itself whereas in GRAPE they need to be implemented as penalty functions. For GOAT the derivatives are calculated by extending the equations of motions to solve for the gradient of the unitary using the gradient of the Hamiltonian which requires some chain rule work.</p>
<p>All the work pouring into automatic differentiation has made implementing these two approaches rather straightforward without any extra work to implement the particular approaches of the GRAPE (saving forward and backwards evolution or GOAT (extending the equations of motion to include the derivative) approaches. The Schuster group has a paper discussing how to apply TensorFlow to GRAPE <sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>. Here, I&rsquo;ll show how we can use parts of the <a href="https://sciml.ai/">SciML</a> framework in Julia to implement the GOAT approach without having to actually implement GOAT.</p>
<p>The DRAG approach <sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>,<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup> for limiting the effects of nearby leakage levels was initially discovered from numerical quantum optimal control. The team was searching for pulse shapes for transmon qubits and kept landing on the same looking pulse which was then later justified by the full DRAG theory. The problem is a great sanity check for any quantum optimal control package: given a three level system &mdash; two qubit levels and a nearby leakage level &mdash; trying to optimize a qubit unitary should give something that looks like a DRAG pulse.</p>
<p><a href="https://nbviewer.jupyter.org/gist/caryan/a6883325c5cf3ba0a5ae54fce0645613">notebook nbviewer link with plots</a></p>
<script src="https://gist.github.com/caryan/a6883325c5cf3ba0a5ae54fce0645613.js"></script>

<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Khaneja, N., Reiss, T., Kehlet, C., Schulte-Herbrüggen, T., &amp; Glaser, S. J. (2005). Optimal control of coupled spin dynamics: design of NMR pulse sequences by gradient ascent algorithms. <a href="https://doi.org/10.1016/j.jmr.2004.11.004">Journal of Magnetic Resonance, 172(2), 296–305</a>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Levante, T. O., Bremi, T., &amp; Ernst, R. R. (1996). Pulse-sequence optimization with analytical derivatives. Application to deuterium decoupling in oriented phases. [Journal of Magnetic Resonance - Series A, 121(2), 167–177() https://doi.org/10.1006/jmra.1996.0157).&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Machnes, S., Assémat, E., Tannor, D., &amp; Wilhelm, F. K. (2018). Tunable, Flexible, and Efficient Optimization of Control Pulses for Practical Qubits. Physical Review Letters, 120, 150401. <a href="https://doi.org/10.1103/PhysRevLett.120.150401">https://doi.org/10.1103/PhysRevLett.120.150401</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>Leung, N., Abdelhafez, M., Koch, J., &amp; Schuster, D. (2017). Speedup for quantum optimal control from automatic differentiation based on graphics processing units. <a href="https://doi.org/10.1103/PhysRevA.95.042318">Physical Review A, 95(4), 042318</a>.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>Motzoi, F., Gambetta, J. M., Rebentrost, P., &amp; Wilhelm, F. K. (2009). Simple Pulses for Elimination of Leakage in Weakly Nonlinear Qubits. <a href="https://doi.org/10.1103/PhysRevLett.103.110501">Physical Review Letters, 103 (11), 110501</a>.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>Gambetta, J., Motzoi, F., Merkel, S., &amp; Wilhelm, F. (2011). Analytic control methods for high-fidelity unitary operations in a weakly nonlinear oscillator. <a href="https://doi.org/10.1103/PhysRevA.83.012308">Physical Review A, 83(1), 012308</a>.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

        </section>
        <div class="post-tags">
          
          
          <nav class="nav tags">
            <ul class="tags">
              
              <li><a href="/tags/software">software</a></li>
              
              <li><a href="/tags/julia">julia</a></li>
              
            </ul>
          </nav>
          
          
        </div>
      </div>

      
      
    </div>

    </article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="mailto:colm@colmryan.org" rel="me" title="Email"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#mail" />
</svg></a><a class="border"></a><a class="soc" href="https://github.com/caryan/" rel="me" title="GitHub"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#github" />
</svg></a><a class="border"></a><a class="soc" href="https://gitlab.com/caryan" rel="me" title="GitLab"><svg class="feather">
   <use href="/svg/feather-sprite.51cf5647cb1987f769b616558f2620fd9423d72058490231b391bf6aa3744b55.svg#gitlab" />
</svg></a><a class="border"></a></div>
  <div class="footer-info">
    2025  © Colm Ryan |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>



</div>
    </body>
</html>
